# `find_and_replace_with_replacement`

## Назначение

Функция `find_and_replace_with_replacement` проходит по списку файлов и **заменяет все вхождения текста, соответствующие регулярному выражению**, на заданную строку замены.  

Используется вместе с функцией `walk_dir` для массовой замены текста в файлах проекта.

---

## Сигнатура функции

```rust
fn find_and_replace_with_replacement(paths: &[String], regex: &Regex, replacement: &str)
````

**Пояснение параметров:**

* `paths: &[String]` — список файлов (пути в виде строк), которые нужно обработать.
* `regex: &Regex` — регулярное выражение для поиска текста в файлах.
* `replacement: &str` — строка, на которую заменяются все найденные совпадения.

---

## Как работает функция

1. Проходим по каждому файлу из `paths`:

```rust
for path in paths {
```

2. Читаем содержимое файла:

```rust
match fs::read_to_string(path) {
    Ok(contents) => { ... }
    Err(err) => { eprintln!("Не удалось прочитать {}: {}", path, err); }
}
```

* Если файл не удаётся прочитать, выводим ошибку, но продолжаем обработку остальных файлов.

3. Применяем регулярное выражение к содержимому файла:

```rust
let updated = regex.replace_all(&contents, replacement);
```

* `replace_all` возвращает новую строку, где все совпадения заменены на `replacement`.

4. Проверяем, изменился ли файл:

```rust
if updated == contents { continue; }
```

* Если изменений нет, переходим к следующему файлу.

5. Пишем обновлённое содержимое обратно в файл:

```rust
if let Err(err) = fs::write(path, updated.as_bytes()) {
    eprintln!("Не удалось записать {}: {}", path, err);
}
```

* Если запись не удалась, выводим ошибку.

---

## Пример использования

```rust
use regex::Regex;

let paths = walk_dir("src", &["swift", "txt"], &["private"]);
let regex = Regex::new(r"Constants\.c(\d+)\.rawValue").unwrap();
let replacement = "Constants.c$1";
find_and_replace_with_replacement(&paths, &regex, replacement);
```

**Что произойдёт:**

* Найдутся все строки вида `Constants.c12.rawValue`
* Они заменятся на `Constants.c12`

---

# Мини-справка по регулярным выражениям (Regex)

Регулярные выражения позволяют находить **шаблоны текста** в файлах.

### Основные конструкции:

* `.` — любой символ, кроме перевода строки
* `\.` — **символ точки**. В regex точка имеет специальное значение, поэтому её нужно экранировать `\.`
* `\d` — цифра `[0-9]`
* `\w` — буква, цифра или `_`
* `+` — один или более символов
* `*` — ноль или более символов
* `( ... )` — **capture-группа**, позволяет потом ссылаться на найденный текст через `$1`, `$2` и т.д.

---

### Примеры

1. Найти все константы `Constants.cXX.rawValue`, где XX — число:

```regex
Constants\.c(\d+)\.rawValue
```

* `\.` — точка
* `(\d+)` — первая capture-группа, одна или более цифр
* В строке `"Constants.c12.rawValue"` группа `$1` = `12`

2. Заменить найденные константы на `Constants.c12` (сохранив число из группы):

```text
Constants.c$1
```

* `$1` — ссылка на первую capture-группу

---

### Советы по работе с Regex

* Всегда тестируйте регулярки на небольших примерах перед массовой заменой.
* Используйте `\` для экранирования специальных символов (`.`, `*`, `+`, `?`).
* Capture-группы позволяют динамически использовать части найденной строки в замене.

---

### Полезные ссылки

* [Документация Rust regex](https://docs.rs/regex/latest/regex/)
* [Регулярные выражения — справочник](https://www.regular-expressions.info/)